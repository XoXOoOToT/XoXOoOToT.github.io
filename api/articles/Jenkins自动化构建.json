{"title":"Jenkins自动化构建","uid":"eedcb098857bb84429a9da676b0dd51c","slug":"Jenkins自动化构建","date":"2019-07-08T07:14:28.000Z","updated":"2021-07-08T07:24:33.612Z","comments":true,"path":"api/articles/Jenkins自动化构建.json","keywords":null,"cover":"/images/2.jpg","content":"<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/back.jpg\" alt=\"back\" style=\"zoom:50%;\">\n\n\n\n<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>在此记录一下jenkins的配置即自动化部署的步骤。</p>\n<span id=\"more\"></span>\n\n\n\n<h1 id=\"Jenkins的环境配置\"><a href=\"#Jenkins的环境配置\" class=\"headerlink\" title=\"Jenkins的环境配置\"></a>Jenkins的环境配置</h1><p><strong>首先maven，git，jdk都必须和jenkins安装在同一个服务器。</strong></p>\n<h2 id=\"下载插件（通用插件）\"><a href=\"#下载插件（通用插件）\" class=\"headerlink\" title=\"下载插件（通用插件）\"></a>下载插件（通用插件）</h2><table>\n<thead>\n<tr>\n<th>Deploy to container Plugin(这个用来发布war的应用，推送到指定服务器上的tomcat)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Maven Integration plugin（maven插件）</td>\n</tr>\n<tr>\n<td>Git plugin（git插件）</td>\n</tr>\n<tr>\n<td>Subversion Plug-in（svn）</td>\n</tr>\n<tr>\n<td>publish over ssh （将构建完的包传到指定服务器）</td>\n</tr>\n</tbody></table>\n<h2 id=\"配置基础环境\"><a href=\"#配置基础环境\" class=\"headerlink\" title=\"配置基础环境\"></a>配置基础环境</h2><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737237921.png\" alt=\"1557737237921\" style=\"zoom:67%;\">\n\n<h3 id=\"配置Maven的conf\"><a href=\"#配置Maven的conf\" class=\"headerlink\" title=\"配置Maven的conf\"></a>配置Maven的conf</h3><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737310688.png\" alt=\"1557737310688\" style=\"zoom:67%;\">\n\n<h3 id=\"配置jdk\"><a href=\"#配置jdk\" class=\"headerlink\" title=\"配置jdk\"></a>配置jdk</h3><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737353178.png\" alt=\"1557737353178\" style=\"zoom:67%;\">\n\n<h3 id=\"配置git\"><a href=\"#配置git\" class=\"headerlink\" title=\"配置git\"></a>配置git</h3><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737387021.png\" alt=\"1557737387021\" style=\"zoom:67%;\">\n\n\n\n<h3 id=\"配置maven\"><a href=\"#配置maven\" class=\"headerlink\" title=\"配置maven\"></a>配置maven</h3><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737418760.png\" alt=\"1557737418760\" style=\"zoom:67%;\">\n\n\n\n\n\n\n\n<h2 id=\"配置需要推送的服务器地址\"><a href=\"#配置需要推送的服务器地址\" class=\"headerlink\" title=\"配置需要推送的服务器地址\"></a>配置需要推送的服务器地址</h2><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737505353.png\" alt=\"1557737505353\" style=\"zoom:67%;\">\n\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737566184.png\" alt=\"1557737566184\" style=\"zoom:67%;\">\n\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737665699.png\" alt=\"1557737665699\" style=\"zoom:67%;\">\n\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557737684868.png\" alt=\"1557737684868\" style=\"zoom:67%;\">\n\n\n\n\n\n\n\n<h1 id=\"新建部署任务\"><a href=\"#新建部署任务\" class=\"headerlink\" title=\"新建部署任务\"></a>新建部署任务</h1><h2 id=\"新建任务\"><a href=\"#新建任务\" class=\"headerlink\" title=\"新建任务\"></a>新建任务</h2><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557832550025.png\" alt=\"1557832550025\" style=\"zoom:67%;\">\n\n<h2 id=\"配置Job\"><a href=\"#配置Job\" class=\"headerlink\" title=\"配置Job\"></a>配置Job</h2><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557832572224.png\" alt=\"1557832572224\" style=\"zoom:67%;\">\n\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557832577069.png\" alt=\"1557832577069\" style=\"zoom:67%;\">\n\n<h3 id=\"添加Credentitals\"><a href=\"#添加Credentitals\" class=\"headerlink\" title=\"添加Credentitals\"></a>添加Credentitals</h3><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557738698570.png\" alt=\"1557738698570\" style=\"zoom:67%;\">\n\n\n\n<h2 id=\"配置触发器（Build-Triggers）\"><a href=\"#配置触发器（Build-Triggers）\" class=\"headerlink\" title=\"配置触发器（Build Triggers）\"></a>配置触发器（Build Triggers）</h2><p><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557832677654.png\" alt=\"1557832677654\"></p>\n<p>这里由于修改了svn仓库的webhook所以当有代码提交会自动更新部署。</p>\n<h3 id=\"定时任务用法\"><a href=\"#定时任务用法\" class=\"headerlink\" title=\"定时任务用法\"></a>定时任务用法</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>区别</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>定时构建</td>\n<td>定时构建是不管仓库中的 代码有没有变，到了时间就会构建</td>\n</tr>\n<tr>\n<td>轮询SCM</td>\n<td>轮询是定时检查源码有没有变，变了才会checkout出来构建。</td>\n</tr>\n</tbody></table>\n<p>定时器构建语法：*  *  *  *  *</p>\n<ul>\n<li>星号之间是有个空格的！！！！</li>\n<li>第一个*代表分钟，范围0-59</li>\n<li>第二个*代表小事，范围0-23</li>\n<li>第三个*代表一个月的第几天，范围1-31</li>\n<li>第四个*代表第几个月，范围1-12</li>\n<li>第五个*代表一周中的第几天，范围0-7，其中0和7都代表周天</li>\n</ul>\n<p>举个栗子：</p>\n<p>1、每10分钟构建一次————-》   H/10 * * * *        <strong>==其中H是形参（必须是H）==</strong></p>\n<p>2、每10个小时构建一次———-》  H H/10 * * *   </p>\n<p>3、每天23点，6点构建一次——》 0  6,23 * * *     像多个时间点就用逗号隔开。</p>\n<h2 id=\"构建环境（build-environment）\"><a href=\"#构建环境（build-environment）\" class=\"headerlink\" title=\"构建环境（build environment）\"></a>构建环境（build environment）</h2><p><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557833583949.png\" alt=\"1557833583949\"></p>\n<h2 id=\"构建（Build）\"><a href=\"#构建（Build）\" class=\"headerlink\" title=\"构建（Build）\"></a>构建（Build）</h2><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557833642479.png\" alt=\"1557833642479\" style=\"zoom:67%;\">\n\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557833686100.png\" alt=\"1557833686100\" style=\"zoom:67%;\">\n\n\n\n<h3 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><p>这个POM的路径是根据你要构建项目的pom来决定的。</p>\n<p>举个栗子：</p>\n<p>这个项目的项目结构是这样的。</p>\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557833983801.png\" alt=\"1557833983801\" style=\"zoom:67%;\">\n\n<p>像这样项目结构的，我们直接用最外面的父POM就可以。</p>\n<p>但是如果是我只想要一个父项目里面的指定的一个子模块，就需要指定编译pom文件路径。</p>\n<p>例如这个项目的结构是：</p>\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557834521846.png\" alt=\"1557834521846\" style=\"zoom:67%;\">\n\n<p>所以system的pom的构建路径就会变成：</p>\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557834571321.png\" alt=\"1557834571321\" style=\"zoom:67%;\">\n\n\n\n\n\n<h2 id=\"构建后（post-build-Action）\"><a href=\"#构建后（post-build-Action）\" class=\"headerlink\" title=\"构建后（post-build Action）\"></a>构建后（post-build Action）</h2><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557834797780.png\" alt=\"1557834797780\" style=\"zoom:67%;\">\n\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557834809040.png\" alt=\"1557834809040\" style=\"zoom:67%;\">\n\n\n\n<h1 id=\"脚本配置\"><a href=\"#脚本配置\" class=\"headerlink\" title=\"脚本配置\"></a>脚本配置</h1><p><strong>把下面的脚本复制到对应服务器上的对应文件夹</strong>，并命名为start.sh。请注意编码，不然可能会出现脚本错误，例如空格之类的。</p>\n<h2 id=\"脚本内容及需要修改的地方\"><a href=\"#脚本内容及需要修改的地方\" class=\"headerlink\" title=\"脚本内容及需要修改的地方\"></a>脚本内容及需要修改的地方</h2><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">TE&#x3D;$(date +%Y%m%d%H%M)\nexport JAVA_HOME PATH CLASSPATH\n#这个是服务器上的java环境变量（自行修改）\nJAVA_HOME&#x3D;&#x2F;opt&#x2F;java&#x2F;jdk1.8.0_191\nPATH&#x3D;$JAVA_HOME&#x2F;bin:$JAVA_HOME&#x2F;jre&#x2F;bin:$PATH\nCLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib:$JAVA_HOME&#x2F;jre&#x2F;lib:$CLASSPATH\n#这个是目标文件夹(需要修改，按自己设置的路径修改)\nDIR&#x3D;&#x2F;usr&#x2F;jenkins-project&#x2F;test&#x2F;\n#这个是jenkins构建完后发送过来的jar包\nJARFILE&#x3D;test.jar\n\n#这个是备份，正常是不需要的，默认注释掉。\n#if [ ! -d $DIR&#x2F;backup ];then\n#   mkdir -p $DIR&#x2F;backup\n#fi\ncd $DIR\n\n#ps -ef | grep $JARFILE | grep -v grep | awk &#39;&#123;print $2&#125;&#39; | xargs kill -9\n#这一步是杀死程序，这里是按照jar包名称来，所以如果构建多个同个项目的，需要修改jar包名字，不然会被误杀。\nps -ef|grep $JARFILE | grep -v grep | awk &#39;&#123;print $2&#125;&#39; | xargs kill -9\n\n#cp  $JARFILE backup&#x2F;$JARFILE$TE\n#mv -f $DIR&#x2F;$JARFILE .\n\n#启动项目(springboot项目)\njava -jar $JARFILE --spring.profiles.active&#x3D;prod  &gt; out.log &amp;\nif [ $? &#x3D; 0 ];then\n        sleep 30\n        tail -n 50 out.log\nfi<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n\n<h2 id=\"构建项目\"><a href=\"#构建项目\" class=\"headerlink\" title=\"构建项目\"></a>构建项目</h2><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557835542931.png\" alt=\"1557835542931\" style=\"zoom:67%;\">\n\n\n\n\n\n<h1 id=\"war包的部署\"><a href=\"#war包的部署\" class=\"headerlink\" title=\"war包的部署\"></a>war包的部署</h1><p>war包项目只有最后一步和其他项目不一样即发送到服务器的方式。</p>\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557835699012.png\" alt=\"1557835699012\" style=\"zoom:67%;\">\n\n<p>需要发送war到指定服务器的tomcat上。所以我们需要修改那台服务器tomcat认证文件配置。</p>\n<h2 id=\"添加tomcat认证\"><a href=\"#添加tomcat认证\" class=\"headerlink\" title=\"添加tomcat认证\"></a>添加tomcat认证</h2><p><strong>==修改tomcat文件conf下的tomcat-users.xml==</strong></p>\n<pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version='1.0' encoding='utf-8'?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tomcat-users</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>role</span> <span class=\"token attr-name\">rolename</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tomcat<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>role</span> <span class=\"token attr-name\">rolename</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>role1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>role</span> <span class=\"token attr-name\">rolename</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>manager-gui<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>role</span> <span class=\"token attr-name\">rolename</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>manager-script<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>role</span> <span class=\"token attr-name\">rolename</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>manager-status<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    \n  <span class=\"token comment\">&lt;!--加入这一句！！！！！！！！！然后在jenkins上添加这个用户。--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user</span> <span class=\"token attr-name\">username</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tomcat<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">password</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tomcat<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">roles</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tomcat,manager-gui,manager-script,manager-status<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user</span> <span class=\"token attr-name\">username</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>both<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">password</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tomcat<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">roles</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tomcat,role1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user</span> <span class=\"token attr-name\">username</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>role1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">password</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tomcat<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">roles</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>role1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tomcat-users</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h2 id=\"部署方案\"><a href=\"#部署方案\" class=\"headerlink\" title=\"部署方案\"></a>部署方案</h2><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557836196745.png\" alt=\"1557836196745\" style=\"zoom:67%;\">\n\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557836368793.png\" alt=\"1557836368793\" style=\"zoom:67%;\">\n\n\n\n\n\n<h1 id=\"svn和git的webhook实现自动构建\"><a href=\"#svn和git的webhook实现自动构建\" class=\"headerlink\" title=\"svn和git的webhook实现自动构建\"></a>svn和git的webhook实现自动构建</h1><h2 id=\"svn的webhook\"><a href=\"#svn的webhook\" class=\"headerlink\" title=\"svn的webhook\"></a>svn的webhook</h2><p>需要在svn的仓库中添加一个脚本，实现svn请求jenkins实现自动构建。</p>\n<p>1、首先找到svn的hooks目录。</p>\n<p>这个目录是在svn的仓库路径，就是svn存放项目路径下。</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">#我是使用这中暴力搜索，\n[root@ty14 csvn]# find &#x2F; -name svn\n&#x2F;opt&#x2F;csvn&#x2F;bin&#x2F;svn\n&#x2F;opt&#x2F;csvn&#x2F;lib&#x2F;svn-python.2.7&#x2F;svn\n&#x2F;opt&#x2F;csvn&#x2F;lib&#x2F;svn-python.2.4&#x2F;svn\n&#x2F;opt&#x2F;csvn&#x2F;lib&#x2F;svn-python.2.5&#x2F;svn\n&#x2F;opt&#x2F;csvn&#x2F;lib&#x2F;svn-python.2.6&#x2F;svn\n&#x2F;opt&#x2F;csvn&#x2F;lib&#x2F;viewvc&#x2F;vclib&#x2F;svn\n&#x2F;opt&#x2F;apache-tomcat-8.5.31&#x2F;work&#x2F;Catalina&#x2F;localhost&#x2F;svnadmin&#x2F;org&#x2F;apache&#x2F;jsp&#x2F;WEB_002dINF&#x2F;views&#x2F;svn\n&#x2F;mnt&#x2F;sdb1&#x2F;svn\n&#x2F;svn\n#找到了仓库路径。\n[root@ty14 csvn]# cd &#x2F;mnt&#x2F;sdb1&#x2F;svn\n#就在这个repositories下。\n[root@ty14 svn]# ls\ndumps  repositories\n#这下面就是对应某个仓库，例如我要让dev1，里面的项目开启webhook。进入到该文件夹，写入脚本\n[root@ty14 repositories]# ls\ndev1  dev4  dev5  project\n#hooks就这么找到了\n[root@ty14 dev1]# ls\nconf  dav  db  format  hooks  locks  README.txt\n#这个post-commit.tmpl 就是我们要修改的脚本，将它复制一份，重新编写\n[root@ty14 hooks]# ls\npost-lock.tmpl            post-unlock.tmpl  pre-lock.tmpl            pre-unlock.tmpl\npost-commit.tmpl  post-revprop-change.tmpl  pre-commit.tmpl   pre-revprop-change.tmpl  start-commit.tmpl\n[root@ty14 hooks]# cp post-commit.tmpl post-commit<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<p>将下面内容复制到post-commit脚本中</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">#!&#x2F;bin&#x2F;sh\n\nREPOS&#x3D;&quot;$1&quot;              #仓库路径\nREV&#x3D;&quot;$2&quot;                #版本修订号\nTXN_NAME&#x3D;&quot;$3&quot;\n\n\nWGET&#x3D;&#x2F;usr&#x2F;bin&#x2F;wget               #这个wget命令，所以服务器需要安装wget\nSVNLOOK&#x3D;&#x2F;opt&#x2F;csvn&#x2F;bin&#x2F;svnlook    #这个需要找到svn的安装目录，然后找到svnlook即可。\nHOME&#x3D;&#x2F;var&#x2F;www&#x2F;\n\nUUID&#x3D;&#96;$SVNLOOK uuid $REPOS&#96;\nNOTIFY_URL&#x3D;&quot;subversion&#x2F;$&#123;UUID&#125;&#x2F;notifyCommit?rev&#x3D;$&#123;REV&#125;&quot;\nCRUMB_ISSUER_URL&#x3D;&#39;crumbIssuer&#x2F;api&#x2F;xml?xpath&#x3D;concat(&#x2F;&#x2F;crumbRequestField,&quot;:&quot;,&#x2F;&#x2F;crumb)&#39;\n\n#编写对应函数\nfunction notifyCI &#123;\n\t\n\tCISERVER&#x3D;$1\n\n\tHEADER&#x3D;&quot;Content-Type:text&#x2F;plain;charset&#x3D;UTF-8&quot;\n\tCRUMB&#x3D;&#96;$WGET --auth-no-challenge --output-document - $&#123;CISERVER&#125;&#x2F;$&#123;CRUMB_ISSUER_URL&#125;&#96;\n\tif [ &quot;$CRUMB&quot; !&#x3D; &quot;&quot; ]; then HEADER&#x3D;$CRUMB; fi\n\n\t$WGET \\\n\t\t--auth-no-challenge \\\n\t\t--header $HEADER \\\n\t\t--post-data &quot;&#96;$SVNLOOK changed --revision $REV $REPOS&#96;&quot; \\\n\t\t--output-document &quot;-&quot;\\\n\t\t--timeout&#x3D;2 \\\n\t\t$&#123;CISERVER&#125;&#x2F;$&#123;NOTIFY_URL&#125;\n&#125;\n#发送请求\nnotifyCI &quot;http:&#x2F;&#x2F;192.168.203.152:8088&quot;  #这个是jenkins的地址。\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<p>这样就可以在轮询SCM里实现自动发布构建。</p>\n<h2 id=\"git的webhook\"><a href=\"#git的webhook\" class=\"headerlink\" title=\"git的webhook\"></a>git的webhook</h2><p>这个需要安装Generic Webhook Trigger插件，在插件管理搜索直接安装。</p>\n<h3 id=\"任务中配置Generic-Webhook-Trigger\"><a href=\"#任务中配置Generic-Webhook-Trigger\" class=\"headerlink\" title=\"任务中配置Generic Webhook Trigger\"></a>任务中配置Generic Webhook Trigger</h3><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557839094630.png\" alt=\"1557839094630\" style=\"zoom:67%;\">\n\n\n\n<h3 id=\"配置gogs里的仓库\"><a href=\"#配置gogs里的仓库\" class=\"headerlink\" title=\"配置gogs里的仓库\"></a>配置gogs里的仓库</h3><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557838960948.png\" alt=\"1557838960948\" style=\"zoom:67%;\">\n\n<h3 id=\"配置钩子\"><a href=\"#配置钩子\" class=\"headerlink\" title=\"配置钩子\"></a>配置钩子</h3><img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557839300230.png\" alt=\"1557839300230\" style=\"zoom:67%;\">\n\n<img src=\"/post/Jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA/1557839349702.png\" alt=\"1557839349702\" style=\"zoom:67%;\">\n\n\n\n<p>trigger的配置中也有写明用法。</p>\n","feature":true,"text":" 前言在此记录一下jenkins的配置即自动化部署的步骤。 Jenkins的环境配置首先maven，git，jdk都必须和jenkins安装在同一个服务器。 下载插件（通用插件） Deploy to container Plugin(这个用来发布war的应用，推送到指定服务器上的...","link":"","photos":[],"count_time":{"symbolsCount":"5.6k","symbolsTime":"5 mins."},"categories":[{"name":"CI工具","slug":"CI工具","count":1,"path":"api/categories/CI工具.json"}],"tags":[{"name":"CI工具","slug":"CI工具","count":1,"path":"api/tags/CI工具.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Jenkins%E7%9A%84%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">Jenkins的环境配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%8B%E8%BD%BD%E6%8F%92%E4%BB%B6%EF%BC%88%E9%80%9A%E7%94%A8%E6%8F%92%E4%BB%B6%EF%BC%89\"><span class=\"toc-text\">下载插件（通用插件）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">配置基础环境</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEMaven%E7%9A%84conf\"><span class=\"toc-text\">配置Maven的conf</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEjdk\"><span class=\"toc-text\">配置jdk</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEgit\"><span class=\"toc-text\">配置git</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEmaven\"><span class=\"toc-text\">配置maven</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E9%9C%80%E8%A6%81%E6%8E%A8%E9%80%81%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80\"><span class=\"toc-text\">配置需要推送的服务器地址</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%96%B0%E5%BB%BA%E9%83%A8%E7%BD%B2%E4%BB%BB%E5%8A%A1\"><span class=\"toc-text\">新建部署任务</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1\"><span class=\"toc-text\">新建任务</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEJob\"><span class=\"toc-text\">配置Job</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0Credentitals\"><span class=\"toc-text\">添加Credentitals</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E8%A7%A6%E5%8F%91%E5%99%A8%EF%BC%88Build-Triggers%EF%BC%89\"><span class=\"toc-text\">配置触发器（Build Triggers）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%94%A8%E6%B3%95\"><span class=\"toc-text\">定时任务用法</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83%EF%BC%88build-environment%EF%BC%89\"><span class=\"toc-text\">构建环境（build environment）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA%EF%BC%88Build%EF%BC%89\"><span class=\"toc-text\">构建（Build）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9\"><span class=\"toc-text\">注意事项</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA%E5%90%8E%EF%BC%88post-build-Action%EF%BC%89\"><span class=\"toc-text\">构建后（post-build Action）</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%84%9A%E6%9C%AC%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">脚本配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%84%9A%E6%9C%AC%E5%86%85%E5%AE%B9%E5%8F%8A%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%E7%9A%84%E5%9C%B0%E6%96%B9\"><span class=\"toc-text\">脚本内容及需要修改的地方</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE\"><span class=\"toc-text\">构建项目</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#war%E5%8C%85%E7%9A%84%E9%83%A8%E7%BD%B2\"><span class=\"toc-text\">war包的部署</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0tomcat%E8%AE%A4%E8%AF%81\"><span class=\"toc-text\">添加tomcat认证</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">部署方案</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#svn%E5%92%8Cgit%E7%9A%84webhook%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA\"><span class=\"toc-text\">svn和git的webhook实现自动构建</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#svn%E7%9A%84webhook\"><span class=\"toc-text\">svn的webhook</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#git%E7%9A%84webhook\"><span class=\"toc-text\">git的webhook</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%BB%E5%8A%A1%E4%B8%AD%E9%85%8D%E7%BD%AEGeneric-Webhook-Trigger\"><span class=\"toc-text\">任务中配置Generic Webhook Trigger</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEgogs%E9%87%8C%E7%9A%84%E4%BB%93%E5%BA%93\"><span class=\"toc-text\">配置gogs里的仓库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E9%92%A9%E5%AD%90\"><span class=\"toc-text\">配置钩子</span></a></li></ol></li></ol></li></ol>","author":{"name":"96loveslife","slug":"blog-author","avatar":"/images/logo.jpg","link":"/","description":"为什么有一些人放屁可以放很大声? </br></br></br> <b>因为他可能穿了喇叭裤</b>","socials":{"github":"https://github.com/96loveslife","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Mysql离线安装","uid":"cc28c8e7df72b9e1dcfbf18f5ae2769e","slug":"Mysql离线安装","date":"2019-07-08T07:26:09.000Z","updated":"2021-07-08T07:31:46.870Z","comments":true,"path":"api/articles/Mysql离线安装.json","keywords":null,"cover":"/images/3.jpg","text":" 前言因为部分原因，内网不能连上互联网，所以环境搭建只能使用离线安装的方法。在此记录一下mysql的5.7的离线安装。 MYSQL5.7版本基础环境安装首先将系统自带的mariadb删除 [root@localhost &#x2F;]# rpm -qa |grep mariadb...","link":"","photos":[],"count_time":{"symbolsCount":"9.9k","symbolsTime":"9 mins."},"categories":[{"name":"运维","slug":"运维","count":1,"path":"api/categories/运维.json"}],"tags":[{"name":"运维","slug":"运维","count":1,"path":"api/tags/运维.json"}],"author":{"name":"96loveslife","slug":"blog-author","avatar":"/images/logo.jpg","link":"/","description":"为什么有一些人放屁可以放很大声? </br></br></br> <b>因为他可能穿了喇叭裤</b>","socials":{"github":"https://github.com/96loveslife","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{}}